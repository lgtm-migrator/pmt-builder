let expect = require('chai').expect;
let pmtBuilder = require('./pmt-builder');

describe('PMT Builder', () => {
    it('should create valid PMT', () => {
        let expectedPMT = '0600000006fd3a5a79c75df3b58704180847b88594c4d9cc42910ae790346825a12a83018f36a11496eb7aa91c84539859e62bfe1846f56180af983e873e6c3f7f8929c66c3769ca1a527d850df6ae2345099cca1bcc68dcd8a6fd457847d8ea457322c8315528532e0dff0dccc67a25458e1c8a5705db2f6162f3a1e11440d05ebc4c71e0e679416ea007ea3515758bc5849dcabc423e840572074202d8cabbb532899e0ffce0e05b061a0bf92b1a39076f5f62f95668d0fcc0aacaea95be81ff46244d5a02ff0f';
        let transactions =  [
            "8f01832aa125683490e70a9142ccd9c49485b84708180487b5f35dc7795a3afd",
            "6cc629897f3f6c3e873e98af8061f54618fe2be6599853841ca97aeb9614a136",
            "31c8227345ead8477845fda6d8dc68cc1bca9c094523aef60d857d521aca6937",
            "e0714cbc5ed04014e1a1f362612fdb05578a1c8e45257ac6cc0dff0d2e532855",
            "0f9e8932b5bbcad80242077205843e42bcca9d84c58b751535ea07a06e4179e6",
            "5a4d2446ff81be95eacaaac0fcd06856f9625f6f07391a2bf90b1a065be0e0fc"
          ];

        // The PMTs should all match as this implementation simply generates a partial
        // tree using all its leaves regardless of the filtered transaction

        let pmt1 = pmtBuilder.buildPMT([].concat(transactions), transactions[0]);
        expect(pmt1.hex).to.be.eq(expectedPMT);
        let pmt2 = pmtBuilder.buildPMT([].concat(transactions), transactions[1]);
        expect(pmt2.hex).to.be.eq(expectedPMT);
        let pmt3 = pmtBuilder.buildPMT([].concat(transactions), transactions[transactions.length - 1]);
        expect(pmt3.hex).to.be.eq(expectedPMT);
    });

    it('should create an invalid PMT', () => {
        let expectedPMT = '260000002624ca5ebc53f71914a1044252cceb3b39b90f7da57ede83b3bd7b8b2f5b71ce4c94f08c917f897978ce30295b6fa1316d9070adce8027eb5ef56d983c0ad8c5806c8f15d100617fa9633e1efcd78292968c19c0f0ccce41da7d9c82e95f82d1b659d29cd7b447a7e75575d8d44708f52d3a2f6c338d5f191dfad68a3e4f8631b1dc1c5a59f43aeae3ae6f78d6c90744f72bf9dcbc40a739e6d0562fcaa0b408aae830a0f6d5039ff4554da5852a79116edd00b82092263c36852066dd06bd6f9b71ca8d07538e13764fde92bc2f042ebdbb6b2ebc5c8632d9aacfed48a891ff3dd945ce13332ebd57ae29f703b996a2097e7d1d80f19f1d115a7318b745f3f5292b57fab45456ed5091b05c664425ba401b7791d03f1162457711fb00e725dcb465e13ed0907b541884d327a8db14d9166bab1bc7f7446a9a2d14a6835465a31af656257eeb129e294e0f0bc1a07fe1c869d6269a0a016f4e8b7f63cd7c9d4658ddde2148ebc67232e030835f08e80bb28994976ac12c9ec0bea2ea85a4ac5cd20e51ca6a1392b8d42e5946f4a803d91e8b94406fa5e77580d996b90a19fb0f4683f17d8725ebd2ee21f0f4972c3d4380427cc582e0214b9a249fe4d5a14be57eef0292b3f3e4b3adb5665b07f0bf4be4011f7d6fdece879c71da9b7b922f2961c73b9192f4762235e568ad632c4c5ed8b38b4ba008a1fe37593cd43fd5324a92053e1801aaa875bd50e5fd42407430372e17ab81d069fa703157eb698fcb0a566bc1f297296a5d80d305341b4d241ab3bafee5676f70dc90bb069be16f483dd2f0875b4eaa02f9921b80546fbfc59581b407d84bff83134fdc32c0a517037722b7477361a7846f8abf5ba226e8e018871e41600b9cc2766e1ca6404aba5b4837613cf3a3c1737b1729ee927fb2900631d6638a08b5324af96e6f8b7725ce044e351dcdfdbadeb76a149d653beed1ee1dc6a10d84934d8b2442fe856e738cd0cb70c9fadb9d72a3ab282f1dc81c8c5c097c77694bdd2b3eba67b9471b03215a1f126379ad11dbdc13b35a5203dde5d51080972d912c13b2144eab52ae65f7521f80f94424c044dd1c3e845fd91d70648e9b6b5f1f75d81d286525cd91e5dd58adf14f63b306552d0c065d83507c1b385bbc1389c3fe06f3e434078628c865b6ae44c5937051f36b4b65ac0c523bfc4ea7004ccb3bc37e08a6d246036d52b07e3fd00ca135413f528ea28cb19bda159698c97186c8bb9c4e48a43c1e36042957b83f16fe4009ad10220d03ba5f9df50411abab5236a244566f5634e18727f4a55e5868d5f329c1c9a4babc521616fc21684a29423287496c362169af104f53cd0861ff50c810481707838bc46dcc2353dc17f87de7847e7771b2518f4a5624cce97214e3e92b437510883abd16d28740229ad7232cad1cd99362f49aa6f38d7c9386c282a8fc9ec4edcaaeb4697a37846a119758a116e6b8751040d2f959a66712a1242801741aebd5d195659d72904ef75b22e46d4d3b63bf1c65e41825266c3ab4253cbd1b958a69ac1bf3726dc623051978d15d95d5ce8293ede278f6a0c3d7bd049ab809ef6ea348b8b201d6b8efb23cc4026777b7875fdc8209e14b8f1fafef10f347e8840c58aef7833bbde4fad2ccb6d4449f105c327c96fa54cb68b56bfac0af8c5f050788b1175d7f782786b2a2528149ec74d10a4050a271e9263d810affffffffffffffffff3f';

        let transactions =  [
            "4cce715b2f8b7bbdb383de7ea57d0fb9393bebcc524204a11419f753bc5eca24",
            "80c5d80a3c986df55eeb2780cead70906d31a16f5b2930ce7879897f918cf094",
            "b6d1825fe9829c7dda41ceccf0c0198c969282d7fc1e3e63a97f6100d1158f6c",
            "b131864f3e8ad6fa1d195f8d336c2f3a2df50847d4d87555e7a747b4d79cd259",
            "aa08b4a0ca2f56d0e639a740bcdcf92bf74407c9d6786faee3ea3af4595a1cdc",
            "9b6fbd06dd662085363c269220b800dd6e11792a85a54d55f49f03d5f6a030e8",
            "3dff91a848edcfaad932865cbc2e6bbbbd2e042fbc92de4f76138e53078dca71",
            "29f5f345b718735a111d9ff1801d7d7e09a296b903f729ae57bd2e3313ce45d9",
            "b4dc25e700fb11774562113fd091771b40ba2544665cb09150ed5654b4fa572b",
            "1aa3655483a6142d9a6a44f7c71bab6b16d914dba827d38418547b90d03ee165",
            "58469d7ccd637f8b4e6f010a9a26d669c8e17fa0c10b0f4e299e12eb7e2556f6",
            "d25caca485eaa2bec09e2cc16a979489b20be8085f8330e03272c6eb4821dedd",
            "460ffb190ab996d98075e7a56f40948b1ed903a8f446592ed4b892136aca510e",
            "7ee54ba1d5e49f249a4b21e082c57c4280433d2c97f4f021eed2eb25877df183",
            "61292f927b9bda719c87cede6f7d1f01e44bbff0075b66b5adb3e4f3b39202ef",
            "924a32d53fd43c5937fea108a04b8bb3d85e4c2c63ad68e5352276f492913bc7",
            "560acb8f69eb573170fa69d081ab172e3730744042fde550bd75a8aa01183e05",
            "d23d486fe19b06bb90dc706f67e5febab31a244d1b3405d3805d6a2997f2c16b",
            "22770317a5c032dc4f1383ff4bd807b48195c5bf6f54801b92f902aa4e5b87f0",
            "37485bba4a40a61c6e76c29c0b60411e8718e0e826a25bbf8a6f84a7617347b7",
            "4e04ce25778b6f6ef94a32b5088a63d6310690b27f92ee29177b73c1a3f33c61",
            "cbd08c736e85fe42248b4d93840da1c61deed1ee3b659d146ab7debafdcd1d35",
            "1f5a21031b47b967ba3e2bdd4b69777c095c8c1cc81d2f28aba3729ddbfac970",
            "1f52f765ae52ab4e14b2132c912d978010d5e5dd03525ab313dcdb11ad796312",
            "ad58dde591cd2565281dd8751f5f6b9b8e64701dd95f843e1cdd44c02444f980",
            "aeb665c828860734e4f306fec38913bc5b381b7c50835d060c2d5506b3634ff1",
            "3f7eb0526d0346d2a6087ec33bcb4c00a74efc3b520cac654b6bf3517093c544",
            "b8572904361e3ca4484e9cbbc88671c9989615da9bb18ca28e523f4135a10cd0",
            "5ea5f42787e134566f5644a23652abab1104f59d5fba030d2210ad0940fe163f",
            "08cd534f10af6921366c49873242294a6821fc161652bcbaa4c9c129f3d56858",
            "e9cc24564a8f51b271777e84e77df817dc5323cc6dc48b8307174810c850ff61",
            "937c8df3a69af46293d91cad2c23d79a224087d216bd3a881075432be9e31472",
            "1267a659f9d2401075b8e616a15897116a84377a69b4aecaedc49efca882c286",
            "3a6c262518e4651cbf633b4d6de4225bf74e90729d6595d1d5eb1a74012824a1",
            "d7c3a0f678e2ed9382ced5955dd178190523c66d72f31bac698a951bbd3c25b4",
            "af1f8f4be10982dc5f87b7776702c43cb2efb8d601b2b848a36eef09b89a04bd",
            "6bb568cb54fa967c325c109f44d4b6ccd2fae4bd3b83f7ae580c84e847f310ef",
            "813d26e971a250400ad174ec498152a2b28627787f5d17b18807055f8cafc0fa"
        ];

        const txHash = "b6d1825fe9829c7dda41ceccf0c0198c969282d7fc1e3e63a97f6100d1158f6c";
        const resultPmt = pmtBuilder.buildPMT([].concat(transactions), txHash);
        expect(resultPmt.hex).to.be.eq(expectedPMT);
    });
});
